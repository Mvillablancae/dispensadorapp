{% extends "principal/base.html" %}
{% block content %}
    <div class="row"><h1>Tareas Programadas</h1></div>
    <div class="row-6">
        <p>
            <div class="dropdown">
                <div class="input-group">
                    <div class="input-group-btn">
                        Dispositivos: <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Opciones
                        </button>
                        <div class="dropdown-menu" onchange="selectMenu1" aria-labelledby="dropdownMenuButton">
                        {% for device in devices %}
                            {% if device.owner == user %}
                            <a class="dropdown-item" href="#">{{ device.ip_addr }}</a>
                            {% endif %}
                        {% endfor %}
                        </div>  
                    </div>
                </div>
            </p>
            <p>Hora<input type="text" name="lname" id="hour" placeholder="hh:mm"></p>
            <p>Fecha<input type="text" id="datepicker" placeholder="dd/mm"><br></p>
            <p>Gramos<input type="text" id="gramos" placeholder="250"><br></p>
    </div>
    <div class="row-6">
        <input type="submit" value="Programar" onclick="sendData()">
    </div>
    <h1 class='prueba invisible' id='prueba'>asd</h1>
    <ul class="list-group" id="list"></ul>
    <script> 
        
        //var ws = new WebSocket("ws://127.0.0.1:5678/");
        //var messages = document.createElement('ul');
        //ws.onmessage = function (event) {
        //    if(event.data[0]!='#'){
        //        console.log(event.data);
        //        var messages = document.getElementById('list'),
        //        message = document.createElement('li'),
        //        content = document.createTextNode(event.data);
        //        message.className = "list-group-item";
        //        message.appendChild(content);
        //        messages.appendChild(message);
        //    }
        //    else{
        //        print("Mal")
        //    }
        //};
        //Mensaje: ID_IP_DIA_HORA_GR
        function sendData(){
            var ws = new WebSocket("ws://"+$("#prueba").text()+":5678/");
            console.log($("#prueba").text()+"_"+document.getElementById("datepicker").value+"_"+document.getElementById("hour").value
            +"_"+document.getElementById("gramos").value+"\n");
            ws.send($("#prueba").text()+"_"+document.getElementById("datepicker").value+"_"+document.getElementById("hour").value
            +"_"+document.getElementById("gramos").value+"\n");
            ws.close();
        }
        //document.body.appendChild(messages);

        $(".dropdown-menu a ").click(function(){
            $(this).parents(".input-group-btn").find('.btn').text($(this).text());
            //ws.send("traer_info")-> mostrar info respecto a ese dispositivo
            $("#prueba").text($(this).text());
        });

    </script>

{% endblock content %}

